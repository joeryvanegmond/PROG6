/*
Deployment script for BOEF

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "BOEF"
:setvar DefaultFilePrefix "BOEF"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Dropping [dbo].[FK_Accessoire_ToImage]...';


GO
ALTER TABLE [dbo].[Accessoires] DROP CONSTRAINT [FK_Accessoire_ToImage];


GO
PRINT N'Starting rebuilding table [dbo].[AccessoireImage]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_AccessoireImage] (
    [Id]        INT        IDENTITY (1, 1) NOT NULL,
    [Name]      NCHAR (50) NOT NULL,
    [ImagePath] NCHAR (50) NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[AccessoireImage])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_AccessoireImage] ON;
        INSERT INTO [dbo].[tmp_ms_xx_AccessoireImage] ([Id], [Name], [ImagePath])
        SELECT   [Id],
                 [Name],
                 [ImagePath]
        FROM     [dbo].[AccessoireImage]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_AccessoireImage] OFF;
    END

DROP TABLE [dbo].[AccessoireImage];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_AccessoireImage]', N'AccessoireImage';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[FK_Accessoire_ToImage]...';


GO
ALTER TABLE [dbo].[Accessoires] WITH NOCHECK
    ADD CONSTRAINT [FK_Accessoire_ToImage] FOREIGN KEY ([Image]) REFERENCES [dbo].[AccessoireImage] ([Id]);


GO
-- Beest types
insert into BeestType([Type]) values ('Boerderij');
insert into BeestType([Type]) values ('Woestijn');
insert into BeestType([Type]) values ('Jungle');
insert into BeestType([Type]) values ('Sneeuw');

-- Beest images
insert into BeestImage([Name], [ImagePath]) values ('Aap', '~\Images\aap.png');
insert into BeestImage([Name], [ImagePath]) values ('Bever', '~\Images\Bever.png');
insert into BeestImage([Name], [ImagePath]) values ('Doggo', '~\Images\Doggo.png');
insert into BeestImage([Name], [ImagePath]) values ('Donkey', '~\Images\Donkey.png');
insert into BeestImage([Name], [ImagePath]) values ('Duck', '~\Images\Duck.png');
insert into BeestImage([Name], [ImagePath]) values ('IJsbeer', '~\Images\IJsbeer.png');
insert into BeestImage([Name], [ImagePath]) values ('Kat', '~\Images\Kat.png');
insert into BeestImage([Name], [ImagePath]) values ('Kip', '~\Images\Kip.png');
insert into BeestImage([Name], [ImagePath]) values ('Koe', '~\Images\Koe.png');
insert into BeestImage([Name], [ImagePath]) values ('Kuiken', '~\Images\Kuiken.png');
insert into BeestImage([Name], [ImagePath]) values ('Leeuw', '~\Images\Leeuw.png');
insert into BeestImage([Name], [ImagePath]) values ('Olifant', '~\Images\Olifant.png');
insert into BeestImage([Name], [ImagePath]) values ('Pingwing', '~\Images\Pingwing.png');
insert into BeestImage([Name], [ImagePath]) values ('Varken', '~\Images\Varken.png');
insert into BeestImage([Name], [ImagePath]) values ('Zebra', '~\Images\Zebra.png');
insert into BeestImage([Name], [ImagePath]) values ('Zeehond', '~\Images\Zeehond.png');
insert into BeestImage([Name], [ImagePath]) values ('Pingwing', '~\Images\Pingwing.png');
insert into BeestImage([Name], [ImagePath]) values ('notfound', '~\Images\notfound.jpg');

-- Beest
insert into Beest([Name],[Type],[Prijs],[Image]) values('Aap', 'Jungle', '32', '1');
insert into Beest([Name],[Type],[Prijs],[Image]) values('Olfiant', 'Jungle', '102', '12');
insert into Beest([Name],[Type],[Prijs],[Image]) values('Zebra', 'Jungle', '54', '15'); 
insert into Beest([Name],[Type],[Prijs],[Image]) values('Leeuw', 'Jungle', '65', '11'); 
insert into Beest([Name],[Type],[Prijs],[Image]) values('Hond', 'Boerderij', '12', '3');
insert into Beest([Name],[Type],[Prijs],[Image]) values('Ezel', 'Boerderij', '25', '4'); 
insert into Beest([Name],[Type],[Prijs],[Image]) values('Koe', 'Boerderij', '35', '9'); 
insert into Beest([Name],[Type],[Prijs],[Image]) values('Eend', 'Boerderij', '5', '5'); 
insert into Beest([Name],[Type],[Prijs],[Image]) values('Kuiken', 'Boerderij', '2', '10'); 
insert into Beest([Name],[Type],[Prijs],[Image]) values('Pinguïn', 'Sneeuw', '45', '17'); 
insert into Beest([Name],[Type],[Prijs],[Image]) values('IJsbeer', 'Sneeuw', '75', '6');
insert into Beest([Name],[Type],[Prijs],[Image]) values('Zeehond', 'Sneeuw', '52', '16'); 
insert into Beest([Name],[Type],[Prijs],[Image]) values('Kameel', 'Woestijn', '87', '18'); 
insert into Beest([Name],[Type],[Prijs],[Image]) values('Slang', 'Woestijn', '36', '18'); 

-- Accessoire images
insert into AccessoireImage([Name], [ImagePath]) values('notfound', '~\Images\notfound.jpg')

-- Accessoire
insert into Accessoires([Name],[Price],[IdBeest], [Image]) values('Banaan', '5', '1', '1');
insert into Accessoires([Name],[Price],[IdBeest], [Image]) values('Zadel', '22', '3', '1');
insert into Accessoires([Name],[Price],[IdBeest], [Image]) values('Zweep', '12', '4', '1');
insert into Accessoires([Name],[Price],[IdBeest], [Image]) values('Krukje', '25', '4', '1');
insert into Accessoires([Name],[Price],[IdBeest], [Image]) values('Bal', '10', '5', '1');
insert into Accessoires([Name],[Price],[IdBeest], [Image]) values('Dansschoenen', '35', '10', '1');
insert into Accessoires([Name],[Price],[IdBeest], [Image]) values('Bal', '10', '12', '1');

GO

GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [dbo].[Accessoires] WITH CHECK CHECK CONSTRAINT [FK_Accessoire_ToImage];


GO
PRINT N'Update complete.';


GO
